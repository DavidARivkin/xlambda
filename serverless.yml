service: xlambda

frameworkVersion: "=1.45.1"

plugins:
    - serverless-python-requirements

custom:
    pythonRequirements:
        dockerizePip: non-linux
        usePipenv: false
        # zip: true
        slim: true
        noDeploy:
            - boto3

package:
    exclude:
        - __pycache__/**
        - bin/**
        - images/**
        - lib/**
        - lib64/**
        - tests/**
        - share/**
        - lambda-startup-time-analysis.xlsx
        - local.py

provider:
    name: aws
    runtime: python3.7
    stage: dev
    region: us-east-1
    memorySize: 512
    timeout: 900
    versionFunctions: false
    environment:
        STAGE: ${self:provider.stage}
    tags:
        region: ${self:provider.region}

functions:
    professor:
        handler: professor.handler
        name: xlambda-professor-${self:provider.stage}
        description: Central starting point for the Lambda warming process
        events:
            - schedule:
                name: XLambdaSchedule
                description: Schedule the execution of the X-Lambda warming process.
                rate: rate(15 minutes)
                enabled: true
                input:
                    's3_bucket': 'XLambdaBucket'
                    'config_obj_name': 'XLambdaConfig.yml'

    wolverine:
        handler: wolverine.handler
        name: xlambda-wolverine-${self:provider.stage}
        description: Get execution history, request prediction and trigger warming.

    jean:
        handler: jean.handler
        name: xlambda-jean-${self:provider.stage}
        description: Predict how many containers should be kept warm.

    cyclops:
        handler: cyclops.handler
        name: xlambda-cyclops-${self:provider.stage}
        description: Fire up Lambdas concurrently to force warming of containers.
